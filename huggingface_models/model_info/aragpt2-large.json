{"pretrained_model_name": "aubmindlab/aragpt2-large", "description": "---\nlanguage: ar\ndatasets:\n- wikipedia\n- Osian\n- 1.5B-Arabic-Corpus\n- oscar-arabic-unshuffled\n- Assafir(private)\ninference: false\nwidget:\n - text: \"\u064a\u062d\u0643\u0649 \u0623\u0646 \u0645\u0632\u0627\u0631\u0639\u0627 \u0645\u062e\u0627\u062f\u0639\u0627 \u0642\u0627\u0645 \u0628\u0628\u064a\u0639 \u0628\u0626\u0631 \u0627\u0644\u0645\u0627\u0621 \u0627\u0644\u0645\u0648\u062c\u0648\u062f \u0641\u064a \u0623\u0631\u0636\u0647 \u0644\u062c\u0627\u0631\u0647 \u0645\u0642\u0627\u0628\u0644 \u0645\u0628\u0644\u063a \u0643\u0628\u064a\u0631 \u0645\u0646 \u0627\u0644\u0645\u0627\u0644\"\n - text: \"\u0627\u0644\u0642\u062f\u0633 \u0645\u062f\u064a\u0646\u0629 \u062a\u0627\u0631\u064a\u062e\u064a\u0629\u060c \u0628\u0646\u0627\u0647\u0627 \u0627\u0644\u0643\u0646\u0639\u0627\u0646\u064a\u0648\u0646 \u0641\u064a\"\n - text: \"\u0643\u0627\u0646 \u064a\u0627 \u0645\u0627 \u0643\u0627\u0646 \u0641\u064a \u0642\u062f\u064a\u0645 \u0627\u0644\u0632\u0645\u0627\u0646\"\n---\n\n# Arabic GPT2\n\n<img src=\"https://raw.githubusercontent.com/aub-mind/arabert/master/AraGPT2.png\" width=\"100\" align=\"left\"/>\n\nYou can find more information in our paper [AraGPT2](https://arxiv.org/abs/2012.15520)\n\nThe code in this repository was used to train all GPT2 variants. The code support training and fine-tuning GPT2 on GPUs and TPUs via the TPUEstimator API.\n\nGPT2-base and medium uses the code from the `gpt2` folder and can trains models from the [minimaxir/gpt-2-simple](https://github.com/minimaxir/gpt-2-simple) repository.\nThese models were trained using the `lamb` optimizer and follow the same architecture as `gpt2` and are fully compatible with the `transformers` library.\n\nGPT2-large and GPT2-mega were trained using the [imcaspar/gpt2-ml](https://github.com/imcaspar/gpt2-ml/) library, and follow the `grover` architecture. You can use the pytorch classes found in `grover/modeling_gpt2.py` as a direct replacement for classes in the `transformers` library (it should support version `v4.x` from `transformers`).\nBoth models are trained using the `adafactor` optimizer, since the `adam` and `lamb` optimizer use too much memory causing the model to not even fit 1 batch on a TPU core.\n\nAraGPT2 is trained on the same large Arabic Dataset as AraBERTv2.\n\n# Usage\n\n## Testing the model using `transformers`:\n\n```python\nfrom transformers import GPT2TokenizerFast, pipeline\n#for base and medium\nfrom transformers import GPT2LMHeadModel\n#for large and mega\n# pip install arabert\nfrom arabert.aragpt2.grover.modeling_gpt2 import GPT2LMHeadModel\n\nfrom arabert.preprocess import ArabertPreprocessor\n\nMODEL_NAME='aubmindlab/aragpt2-large'\narabert_prep = ArabertPreprocessor(model_name=MODEL_NAME)\n\ntext=\"\"\ntext_clean = arabert_prep.preprocess(text)\n\nmodel = GPT2LMHeadModel.from_pretrained(MODEL_NAME)\ntokenizer = GPT2TokenizerFast.from_pretrained(MODEL_NAME)\ngeneration_pipeline = pipeline(\"text-generation\",model=model,tokenizer=tokenizer)\n\n#feel free to try different decoding settings\ngeneration_pipeline(text,\n    pad_token_id=tokenizer.eos_token_id,\n    num_beams=10,\n    max_length=200,\n    top_p=0.9,\n    repetition_penalty = 3.0,\n    no_repeat_ngram_size = 3)[0]['generated_text']\n>>>\n```\n## Finetunning using `transformers`:\n\nFollow the guide linked [here](https://towardsdatascience.com/fine-tuning-gpt2-on-colab-gpu-for-free-340468c92ed)\n\n## Finetuning using our code with TF 1.15.4:\n\nCreate the Training TFRecords:\n```bash\npython create_pretraining_data.py\n --input_file=<RAW TEXT FILE with documents/article separated by an empty line>\n --output_file=<OUTPUT TFRecord>\n --tokenizer_dir=<Directory with the GPT2 Tokenizer files>\n ```\n\n Finetuning:\n ```bash\n python3 run_pretraining.py \\\\\\r\\n --input_file=\"gs://<GS_BUCKET>/pretraining_data/*\" \\\\\\r\\n --output_dir=\"gs://<GS_BUCKET>/pretraining_model/\" \\\\\\r\\n --config_file=\"config/small_hparams.json\" \\\\\\r\\n --batch_size=128 \\\\\\r\\n --eval_batch_size=8 \\\\\\r\\n --num_train_steps= \\\\\\r\\n --num_warmup_steps= \\\\\\r\\n --learning_rate= \\\\\\r\\n --save_checkpoints_steps= \\\\\\r\\n --max_seq_length=1024 \\\\\\r\\n --max_eval_steps= \\\\\\r\\n --optimizer=\"lamb\" \\\\\\r\\n --iterations_per_loop=5000 \\\\\\r\\n --keep_checkpoint_max=10 \\\\\\r\\n --use_tpu=True \\\\\\r\\n --tpu_name=<TPU NAME> \\\\\\r\\n --do_train=True \\\\\\r\\n --do_eval=False\n ```\n# Model Sizes\n\nModel | Optimizer | Context size | Embedding Size | Num of heads | Num of layers | Model Size / Num of Params |\n ---|:---:|:---:|:---:|:---:|:---:|:---:\nAraGPT2-base | `lamb` | 1024 | 768 | 12 | 12 | 527MB/135M |\nAraGPT2-medium | `lamb` | 1024 | 1024 | 16 | 24 |1.38G/370M |\nAraGPT2-large | `adafactor` | 1024 | 1280 | 20 | 36 | 2.98GB/792M |\nAraGPT2-mega | `adafactor` | 1024 | 1536 | 25 | 48 | 5.5GB/1.46B |\n\nAll models are available in the `HuggingFace` model page under the [aubmindlab](https://huggingface.co/aubmindlab/) name. Checkpoints are available in PyTorch, TF2 and TF1 formats.\n\n## Compute\n\nFor Dataset Source see the [Dataset Section](#Dataset)\n\nModel | Hardware | num of examples (seq len = 1024) | Batch Size | Num of Steps | Time (in days)\n ---|:---:|:---:|:---:|:---:|:---:\nAraGPT2-base | TPUv3-128 | 9.7M | 1792 | 125K | 1.5\nAraGPT2-medium | TPUv3-8 | 9.7M | 1152 | 85K | 1.5\nAraGPT2-large | TPUv3-128 | 9.7M | 256 | 220k | 3\nAraGPT2-mega | TPUv3-128 | 9.7M | 256 | 780K | 9\n\n# Dataset\n\nThe pretraining data used for the new AraBERT model is also used for **GPT2 and ELECTRA**.\n\nThe dataset consists of 77GB or 200,095,961 lines or 8,655,948,860 words or 82,232,988,358 chars (before applying Farasa Segmentation)\n\nFor the new dataset we added the unshuffled OSCAR corpus, after we thoroughly filter it, to the previous dataset used in AraBERTv1 but with out the websites that we previously crawled:\n- OSCAR unshuffled and filtered.\n- [Arabic Wikipedia dump](https://archive.org/details/arwiki-20190201) from 2020/09/01\n- [The 1.5B words Arabic Corpus](https://www.semanticscholar.org/paper/1.5-billion-words-Arabic-Corpus-El-Khair/f3eeef4afb81223df96575adadf808fe7fe440b4)\n- [The OSIAN Corpus](https://www.aclweb.org/anthology/W19-4619)\n- Assafir news articles. Huge thank you for Assafir for giving us the data\n\n# Disclaimer\n\n The text generated by GPT2 Arabic is automatically generated by a neural network model trained on a large amount of texts, which does not represent the authors' or their institutes' official attitudes and preferences. The text generated by GPT2 Arabic should only be used for research and scientific purposes. If it infringes on your rights and interests or violates social morality, please do not propagate it.\n\n# If you used this model please cite us as :\n\n```\n@inproceedings{antoun-etal-2021-aragpt2,\n    title = \"{A}ra{GPT}2: Pre-Trained Transformer for {A}rabic Language Generation\",\n    author = \"Antoun, Wissam  and\n      Baly, Fady  and\n      Hajj, Hazem\",\n    booktitle = \"Proceedings of the Sixth Arabic Natural Language Processing Workshop\",\n    month = apr,\n    year = \"2021\",\n    address = \"Kyiv, Ukraine (Virtual)\",\n    publisher = \"Association for Computational Linguistics\",\n    url = \"https://www.aclweb.org/anthology/2021.wanlp-1.21\",\n    pages = \"196--207\",\n}\n```\n\n# Acknowledgments\nThanks to TensorFlow Research Cloud (TFRC) for the free access to Cloud TPUs, couldn't have done it without this program, and to the [AUB MIND Lab](https://sites.aub.edu.lb/mindlab/) Members for the continuous support. Also thanks to [Yakshof](https://www.yakshof.com/#/) and Assafir for data and storage access. Another thanks for Habib Rahal (https://www.behance.net/rahalhabib), for putting a face to AraBERT.\n\n# Contacts\n**Wissam Antoun**: [Linkedin](https://www.linkedin.com/in/wissam-antoun-622142b4/) | [Twitter](https://twitter.com/wissam_antoun) | [Github](https://github.com/WissamAntoun) | <wfa07@mail.aub.edu> | <wissam.antoun@gmail.com>\n\n**Fady Baly**: [Linkedin](https://www.linkedin.com/in/fadybaly/) | [Twitter](https://twitter.com/fadybaly) | [Github](https://github.com/fadybaly) | <fgb06@mail.aub.edu> | <baly.fady@gmail.com>\n\n", "size_bytes": "3204405344", "downloads": 1338}