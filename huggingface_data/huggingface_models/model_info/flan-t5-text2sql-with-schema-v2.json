{"pretrained_model_name": "juierror/flan-t5-text2sql-with-schema-v2", "description": "---\nlanguage: en\nwidget:\n- text: >-\n    convert question and table into SQL query. tables: people_name(id,name),\n    people_age(people_id,age). question: how many people with name jui and age\n    less than 25\nlicense: cc-by-sa-4.0\npipeline_tag: text2text-generation\ninference:\n  parameters:\n    max_length: 512\n    num_beams: 10\n    top_k: 10\n---\n\nThis is an upgraded version of [https://huggingface.co/juierror/flan-t5-text2sql-with-schema](https://huggingface.co/juierror/flan-t5-text2sql-with-schema). \n\nIt supports the '<' sign and can handle multiple tables.\n\n# How to use\n```python\nfrom typing import List\nfrom transformers import AutoTokenizer, AutoModelForSeq2SeqLM\n\ntokenizer = AutoTokenizer.from_pretrained(\"juierror/flan-t5-text2sql-with-schema-v2\")\nmodel = AutoModelForSeq2SeqLM.from_pretrained(\"juierror/flan-t5-text2sql-with-schema-v2\")\n\ndef get_prompt(tables, question):\n    prompt = f\"\"\"convert question and table into SQL query. tables: {tables}. question: {question}\"\"\"\n    return prompt\n\ndef prepare_input(question: str, tables: Dict[str, List[str]]):\n    tables = [f\"\"\"{table_name}({\",\".join(tables[table_name])})\"\"\" for table_name in tables]\n    tables = \", \".join(tables)\n    prompt = get_prompt(tables, question)\n    input_ids = tokenizer(prompt, max_length=512, return_tensors=\"pt\").input_ids\n    return input_ids\n\ndef inference(question: str, tables: Dict[str, List[str]]) -> str:\n    input_data = prepare_input(question=question, tables=tables)\n    input_data = input_data.to(model.device)\n    outputs = model.generate(inputs=input_data, num_beams=10, top_k=10, max_length=512)\n    result = tokenizer.decode(token_ids=outputs[0], skip_special_tokens=True)\n    return result\n\nprint(inference(\"how many people with name jui and age less than 25\", {\n    \"people_name\": [\"id\", \"name\"],\n    \"people_age\": [\"people_id\", \"age\"]\n}))\n\nprint(inference(\"what is id with name jui and age less than 25\", {\n    \"people_name\": [\"id\", \"name\", \"age\"]\n})))\n```\n\n# Dataset\n- [CoSQL](https://yale-lily.github.io/cosql)\n- [spider](https://yale-lily.github.io/spider)\n- [SParC](https://yale-lily.github.io/sparc)", "size_bytes": "990239029", "downloads": 258}