{"pretrained_model_name": "google/switch-base-8", "description": "---\nlanguage: \n- en\n\ntags:\n- text2text-generation\n\nwidget:\n- text: \"The <extra_id_0> walks in <extra_id_1> park\"\n  example_title: \"Masked Language Modeling\"\n\ndatasets:\n- c4\n\n\nlicense: apache-2.0\n---\n\n# Model Card for Switch Transformers Base - 8 experts\n\n![model image](https://s3.amazonaws.com/moonup/production/uploads/1666966931908-62441d1d9fdefb55a0b7d12c.png)\n\n#  Table of Contents\n\n0. [TL;DR](#TL;DR)\n1. [Model Details](#model-details)\n2. [Usage](#usage)\n3. [Uses](#uses)\n4. [Bias, Risks, and Limitations](#bias-risks-and-limitations)\n5. [Training Details](#training-details)\n6. [Evaluation](#evaluation)\n7. [Environmental Impact](#environmental-impact)\n8. [Citation](#citation)\n9. [Model Card Authors](#model-card-authors)\n\n# TL;DR\n\nSwitch Transformers is a Mixture of Experts (MoE) model trained on Masked Language Modeling (MLM) task. The model architecture is similar to the classic T5, but with the Feed Forward layers replaced by the Sparse MLP layers containing \"experts\" MLP. According to the [original paper](https://arxiv.org/pdf/2101.03961.pdf) the model enables faster training (scaling properties) while being better than T5 on fine-tuned tasks. \nAs mentioned in the first few lines of the abstract : \n>  we advance the current scale of language models by pre-training up to trillion parameter models on the \u201cColossal Clean Crawled Corpus\u201d, and achieve a 4x speedup over the T5-XXL model.\n\n**Disclaimer**: Content from **this** model card has been written by the Hugging Face team, and parts of it were copy pasted from the [original paper](https://arxiv.org/pdf/2101.03961.pdf).\n\n# Model Details\n\n## Model Description\n\n\n- **Model type:** Language model\n- **Language(s) (NLP):** English\n- **License:** Apache 2.0\n- **Related Models:** [All Switch Transformers Checkpoints](https://huggingface.co/models?search=switch)\n- **Original Checkpoints:** [All Original Switch Transformers Checkpoints](https://github.com/google-research/t5x/blob/main/docs/models.md#mixture-of-experts-moe-checkpoints)\n- **Resources for more information:**\n  - [Research paper](https://arxiv.org/pdf/2101.03961.pdf)\n  - [GitHub Repo](https://github.com/google-research/t5x)\n  - [Hugging Face Switch Transformers Docs (Similar to T5) ](https://huggingface.co/docs/transformers/model_doc/switch_transformers)\n\n# Usage\n\nNote that these checkpoints has been trained on Masked-Language Modeling (MLM) task. Therefore the checkpoints are not \"ready-to-use\" for downstream tasks. You may want to check `FLAN-T5` for running fine-tuned weights or fine-tune your own MoE following [this notebook](https://colab.research.google.com/drive/1aGGVHZmtKmcNBbAwa9hbu58DDpIuB5O4?usp=sharing)\n\nFind below some example scripts on how to use the model in `transformers`:\n\n## Using the Pytorch model\n\n### Running the model on a CPU\n\n<details>\n<summary> Click to expand </summary>\n\n```python\n\nfrom transformers import AutoTokenizer, SwitchTransformersForConditionalGeneration\n\ntokenizer = AutoTokenizer.from_pretrained(\"google/switch-base-8\")\nmodel = SwitchTransformersForConditionalGeneration.from_pretrained(\"google/switch-base-8\")\n\ninput_text = \"A <extra_id_0> walks into a bar a orders a <extra_id_1> with <extra_id_2> pinch of <extra_id_3>.\"\ninput_ids = tokenizer(input_text, return_tensors=\"pt\").input_ids\n\noutputs = model.generate(input_ids)\nprint(tokenizer.decode(outputs[0]))\n>>> <pad> <extra_id_0> man<extra_id_1> beer<extra_id_2> a<extra_id_3> salt<extra_id_4>.</s>\n```\n\n</details>\n\n### Running the model on a GPU\n\n<details>\n<summary> Click to expand </summary>\n\n```python\n# pip install accelerate\nfrom transformers import AutoTokenizer, SwitchTransformersForConditionalGeneration\n\ntokenizer = AutoTokenizer.from_pretrained(\"google/switch-base-8\")\nmodel = SwitchTransformersForConditionalGeneration.from_pretrained(\"google/switch-base-8\", device_map=\"auto\")\n\ninput_text = \"A <extra_id_0> walks into a bar a orders a <extra_id_1> with <extra_id_2> pinch of <extra_id_3>.\"\ninput_ids = tokenizer(input_text, return_tensors=\"pt\").input_ids.to(0)\n\noutputs = model.generate(input_ids)\nprint(tokenizer.decode(outputs[0]))\n>>> <pad> <extra_id_0> man<extra_id_1> beer<extra_id_2> a<extra_id_3> salt<extra_id_4>.</s>\n```\n\n</details>\n\n### Running the model on a GPU using different precisions\n\n#### FP16\n\n<details>\n<summary> Click to expand </summary>\n\n```python\n# pip install accelerate\nfrom transformers import AutoTokenizer, SwitchTransformersForConditionalGeneration\n\ntokenizer = AutoTokenizer.from_pretrained(\"google/switch-base-8\")\nmodel = SwitchTransformersForConditionalGeneration.from_pretrained(\"google/switch-base-8\", device_map=\"auto\", torch_dtype=torch.float16)\n\ninput_text = \"A <extra_id_0> walks into a bar a orders a <extra_id_1> with <extra_id_2> pinch of <extra_id_3>.\"\ninput_ids = tokenizer(input_text, return_tensors=\"pt\").input_ids.to(0)\n\noutputs = model.generate(input_ids)\nprint(tokenizer.decode(outputs[0]))\n>>> <pad> <extra_id_0> man<extra_id_1> beer<extra_id_2> a<extra_id_3> salt<extra_id_4>.</s>\n```\n\n</details>\n\n#### INT8\n\n<details>\n<summary> Click to expand </summary>\n\n```python\n# pip install bitsandbytes accelerate\nfrom transformers import AutoTokenizer, SwitchTransformersForConditionalGeneration\n\ntokenizer = AutoTokenizer.from_pretrained(\"google/switch-base-8\")\nmodel = SwitchTransformersForConditionalGeneration.from_pretrained(\"google/switch-base-8\", device_map=\"auto\")\n\ninput_text = \"A <extra_id_0> walks into a bar a orders a <extra_id_1> with <extra_id_2> pinch of <extra_id_3>.\"\ninput_ids = tokenizer(input_text, return_tensors=\"pt\").input_ids.to(0)\n\noutputs = model.generate(input_ids)\nprint(tokenizer.decode(outputs[0]))\n>>> <pad> <extra_id_0> man<extra_id_1> beer<extra_id_2> a<extra_id_3> salt<extra_id_4>.</s>\n```\n\n</details>\n\n# Uses\n\n## Direct Use and Downstream Use\n\nSee the [research paper](https://arxiv.org/pdf/2101.03961.pdf) for further details.\n\n## Out-of-Scope Use\n\nMore information needed.\n\n# Bias, Risks, and Limitations\n\nMore information needed.\n\n## Ethical considerations and risks\n\nMore information needed.\n\n## Known Limitations\n\nMore information needed.\n\n## Sensitive Use:\n\nMore information needed.\n\n# Training Details\n\n## Training Data\n\nThe model was trained on a Masked Language Modeling task, on Colossal Clean Crawled Corpus (C4) dataset, following the same procedure as `T5`.\n\n\n## Training Procedure\n\nAccording to the model card from the [original paper](https://arxiv.org/pdf/2101.03961.pdf) the model has been trained on TPU v3 or TPU v4 pods, using [`t5x`](https://github.com/google-research/t5x) codebase together with [`jax`](https://github.com/google/jax).\n\n\n# Evaluation\n\n## Testing Data, Factors & Metrics\n\nThe authors evaluated the model on various tasks and compared the results against T5. See the table below for some quantitative evaluation:\n![image.png](https://s3.amazonaws.com/moonup/production/uploads/1666967660372-62441d1d9fdefb55a0b7d12c.png)\nFor full details, please check the [research paper](https://arxiv.org/pdf/2101.03961.pdf).\n\n## Results \n\nFor full results for Switch Transformers, see the [research paper](https://arxiv.org/pdf/2101.03961.pdf), Table 5.\n\n# Environmental Impact\n\nCarbon emissions can be estimated using the [Machine Learning Impact calculator](https://mlco2.github.io/impact#compute) presented in [Lacoste et al. (2019)](https://arxiv.org/abs/1910.09700).\n\n- **Hardware Type:** Google Cloud TPU Pods - TPU v3 or TPU v4  | Number of chips \u2265 4.\n- **Hours used:** More information needed\n- **Cloud Provider:** GCP\n- **Compute Region:** More information needed\n- **Carbon Emitted:** More information needed\n\n# Citation\n\n**BibTeX:**\n\n```bibtex\n@misc{https://doi.org/10.48550/arxiv.2101.03961,\n  doi = {10.48550/ARXIV.2101.03961},\n  \n  url = {https://arxiv.org/abs/2101.03961},\n  \n  author = {Fedus, William and Zoph, Barret and Shazeer, Noam},\n  \n  keywords = {Machine Learning (cs.LG), Artificial Intelligence (cs.AI), FOS: Computer and information sciences, FOS: Computer and information sciences},\n  \n  title = {Switch Transformers: Scaling to Trillion Parameter Models with Simple and Efficient Sparsity},\n  \n  publisher = {arXiv},\n  \n  year = {2021},\n  \n  copyright = {arXiv.org perpetual, non-exclusive license}\n}\n\n```", "size_bytes": "1238895063", "downloads": 5533}